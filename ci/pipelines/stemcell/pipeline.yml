---
groups:
  - name: all
    jobs:
      - build-stemcell
      - publish-stemcells
      - tag-stemcell
      - test-stemcells
      - build-warden-boshlite-centos-7
      - build-warden-boshlite-ubuntu-trusty
      - build-aws-xen-centos-7
      - build-aws-xen-ubuntu-trusty
      - build-azure-hyperv-centos-7
      - build-azure-hyperv-ubuntu-trusty
      - build-google-kvm-centos-7
      - build-google-kvm-ubuntu-trusty
      - build-openstack-kvm-centos-7
      - build-openstack-kvm-ubuntu-trusty
      - build-softlayer-xen-centos-7
      - build-softlayer-xen-ubuntu-trusty
      - build-vsphere-esxi-centos-7
      - build-vsphere-esxi-ubuntu-trusty
      - build-vcloud-esxi-ubuntu-trusty
  - name: aws
    jobs:
      - build-aws-xen-ubuntu-trusty
      - build-aws-xen-centos-7
  - name: azure
    jobs:
      - build-azure-hyperv-ubuntu-trusty
      - build-azure-hyperv-centos-7
  - name: google
    jobs:
      - build-google-kvm-ubuntu-trusty
      - build-google-kvm-centos-7
  - name: openstack
    jobs:
      - build-openstack-kvm-ubuntu-trusty
      - build-openstack-kvm-centos-7
  - name: softlayer
    jobs:
      - build-softlayer-xen-ubuntu-trusty
      - build-softlayer-xen-centos-7
  - name: vsphere
    jobs:
      - build-vsphere-esxi-ubuntu-trusty
      - build-vsphere-esxi-centos-7
  - name: vcloud
    jobs:
      - build-vcloud-esxi-ubuntu-trusty
  - name: ubuntu
    jobs:
      - build-aws-xen-ubuntu-trusty
      - build-azure-hyperv-ubuntu-trusty
      - build-google-kvm-ubuntu-trusty
      - build-openstack-kvm-ubuntu-trusty
      - build-softlayer-xen-ubuntu-trusty
      - build-vsphere-esxi-ubuntu-trusty
      - build-vcloud-esxi-ubuntu-trusty
  - name: centos
    jobs:
      - build-aws-xen-centos-7
      - build-azure-hyperv-centos-7
      - build-google-kvm-centos-7
      - build-openstack-kvm-centos-7
      - build-softlayer-xen-centos-7
      - build-vsphere-esxi-centos-7

jobs:
  - name: build-stemcell
    serial: true
    plan:
      - get: bosh-src
      - get: version
        params:
          bump: major
      - put: version
        params:
          file: version/number

  - name: test-stemcells
    serial: true
    plan:
      - aggregate:
        - get: version
          tags: [vsphere-v5.1]
          passed:
            - build-stemcell
            - build-warden-boshlite-centos-7
            - build-warden-boshlite-ubuntu-trusty
            - build-aws-xen-ubuntu-trusty
            - build-azure-hyperv-ubuntu-trusty
            - build-google-kvm-ubuntu-trusty
            - build-openstack-kvm-ubuntu-trusty
#            - build-softlayer-xen-ubuntu-trusty
            - build-vsphere-esxi-ubuntu-trusty
            - build-vcloud-esxi-ubuntu-trusty
            - build-aws-xen-centos-7
            - build-azure-hyperv-centos-7
            - build-google-kvm-centos-7
            - build-openstack-kvm-centos-7
            - build-vsphere-esxi-centos-7
        - get: bosh-src
          tags: [vsphere-v5.1]
          passed:
            - build-stemcell
            - build-warden-boshlite-centos-7
            - build-warden-boshlite-ubuntu-trusty
            - build-aws-xen-ubuntu-trusty
            - build-azure-hyperv-ubuntu-trusty
            - build-google-kvm-ubuntu-trusty
            - build-openstack-kvm-ubuntu-trusty
#            - build-softlayer-xen-ubuntu-trusty
            - build-vsphere-esxi-ubuntu-trusty
            - build-vcloud-esxi-ubuntu-trusty
            - build-aws-xen-centos-7
            - build-azure-hyperv-centos-7
            - build-google-kvm-centos-7
            - build-openstack-kvm-centos-7
            - build-vsphere-esxi-centos-7
        - get: syslog-release
        - get: vsphere-esxi-ubuntu-trusty
          passed: [build-vsphere-esxi-ubuntu-trusty]
      - task: test-stemcell
        tags: [vsphere-v5.1]
        file: bosh-src/bosh-stemcell/smoke/test-stemcell.yml
        input_mapping:
          stemcell: vsphere-esxi-ubuntu-trusty
        params:
          BOSH_DIRECTOR_ADDRESS: {{stemcell-test-director-address}}
          BOSH_DIRECTOR_USERNAME: {{stemcell-test-director-username}}
          BOSH_DIRECTOR_PASSWORD: {{stemcell-test-director-password}}

  - name: tag-stemcell
    serial: true
    plan:
    - aggregate:
      - get: version
        trigger: true
        passed:
          - build-stemcell
      - get: bosh-src
        passed:
          - build-stemcell
    - task: tag
      file: bosh-src/ci/pipelines/stemcell/tasks/tag.yml
    - put: bosh-src-push
      params:
        repository: bosh-src-tagged

  - name: publish-stemcells
    serial: true
    plan:
      - aggregate:
        - get: version
          trigger: true
          passed: [test-stemcells]
        - get: bosh-src
          passed: [test-stemcells]
      - task: copy-artifacts
        file: bosh-src/ci/pipelines/stemcell/tasks/publish.yml
        params:
          AWS_ACCESS_KEY_ID: {{stemcell_aws_access_key}}
          AWS_SECRET_ACCESS_KEY: {{stemcell_aws_secret_key}}
          BUCKET_NAME: {{stemcell_bucket}}
          CANDIDATE_PREFIX: bosh-stemcell-candidate/
          PUBLISHED_PREFIX: bosh-stemcell/
          COPY_KEYS: |
            aws/bosh-stemcell-%s-aws-xen-ubuntu-trusty-go_agent.tgz
            aws/bosh-stemcell-%s-aws-xen-centos-7-go_agent.tgz
            google/bosh-stemcell-%s-google-kvm-ubuntu-trusty-go_agent.tgz
            google/bosh-stemcell-%s-google-kvm-centos-7-go_agent.tgz
            openstack/bosh-stemcell-%s-openstack-kvm-ubuntu-trusty-go_agent.tgz
            openstack/bosh-stemcell-%s-openstack-kvm-ubuntu-trusty-go_agent-raw.tgz
            openstack/bosh-stemcell-%s-openstack-kvm-centos-7-go_agent.tgz
            openstack/bosh-stemcell-%s-openstack-kvm-centos-7-go_agent-raw.tgz
            softlayer/bosh-stemcell-%s-softlayer-xen-ubuntu-trusty-go_agent.tgz
            vsphere/bosh-stemcell-%s-vsphere-esxi-ubuntu-trusty-go_agent.tgz
            vsphere/bosh-stemcell-%s-vsphere-esxi-centos-7-go_agent.tgz
            vcloud/bosh-stemcell-%s-vcloud-esxi-ubuntu-trusty-go_agent.tgz
  #
  # WARDEN
  #

  - name: build-warden-boshlite-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         warden
          HYPERVISOR:   boshlite
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: warden-boshlite-ubuntu-trusty
          params:
            file: stemcell/*.tgz

  - name: build-warden-boshlite-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         warden
          HYPERVISOR:   boshlite
          OS_NAME:      centos
          OS_VERSION:   '7'
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: warden-boshlite-centos-7
          params:
            file: stemcell/*.tgz

  #
  # AWS
  #

  - name: build-aws-xen-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         aws
          HYPERVISOR:   xen
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: aws-xen-ubuntu-trusty
          params:
            file: stemcell/*.tgz

  - name: build-aws-xen-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         aws
          HYPERVISOR:   xen
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: aws-xen-centos-7
          params:
            file: stemcell/*.tgz

  #
  # Azure
  #

  - name: build-azure-hyperv-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         azure
          HYPERVISOR:   hyperv
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: azure-hyperv-ubuntu-trusty
          params:
            file: stemcell/*.tgz

  - name: build-azure-hyperv-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         azure
          HYPERVISOR:   hyperv
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: azure-hyperv-centos-7
          params:
            file: stemcell/*.tgz

  #
  # Google
  #

  - name: build-google-kvm-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         google
          HYPERVISOR:   kvm
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: google-kvm-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz

  - name: build-google-kvm-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         google
          HYPERVISOR:   kvm
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: google-kvm-centos-7
          params:
            file: stemcell/*-go_agent.tgz

  #
  # OpenStack
  #

  - name: build-openstack-kvm-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         openstack
          HYPERVISOR:   kvm
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: openstack-kvm-ubuntu-trusty-raw
          params:
            file: stemcell/*-raw.tgz
        - put: openstack-kvm-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz

  - name: build-openstack-kvm-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         openstack
          HYPERVISOR:   kvm
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: openstack-kvm-centos-7-raw
          params:
            file: stemcell/*-raw.tgz
        - put: openstack-kvm-centos-7
          params:
            file: stemcell/*-go_agent.tgz

  #
  # SoftLayer
  #

  - name: build-softlayer-xen-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         softlayer
          HYPERVISOR:   xen
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - put: softlayer-xen-ubuntu-trusty
        params:
          file: stemcell/*-go_agent.tgz

  - name: build-softlayer-xen-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         softlayer
          HYPERVISOR:   xen
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - put: softlayer-xen-centos-7
        params:
          file: stemcell/*-go_agent.tgz

  #
  # vSphere
  #

  - name: build-vsphere-esxi-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         vsphere
          HYPERVISOR:   esxi
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: vsphere-esxi-ubuntu-trusty
          params:
            file: stemcell/*.tgz

  - name: build-vsphere-esxi-centos-7
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         vsphere
          HYPERVISOR:   esxi
          OS_NAME:      centos
          OS_VERSION:   7
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: vsphere-esxi-centos-7
          params:
            file: stemcell/*.tgz

  #
  # vCloud
  #

  - name: build-vcloud-esxi-ubuntu-trusty
    plan:
      - aggregate:
          - get: version
            trigger: true
            passed: [build-stemcell]
          - get: bosh-src
            passed: [build-stemcell]
      - task: create-stemcell
        file: bosh-src/ci/pipelines/stemcell/tasks/build.yml
        privileged: true
        params:
          IAAS:         vcloud
          HYPERVISOR:   esxi
          OS_NAME:      ubuntu
          OS_VERSION:   trusty
          BOSHIO_TOKEN: {{boshio_checksum_token}}
      - aggregate:
        - put: vcloud-esxi-ubuntu-trusty
          params:
            file: stemcell/*.tgz

resources:
  - name: bosh-src-push
    type: git
    source:
      uri: git@github.com:mingxiao/bosh.git
      branch: develop
      private_key: |
        -----BEGIN RSA PRIVATE KEY-----
        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
        -----END RSA PRIVATE KEY-----

  - name: bosh-src
    type: git
    source:
      uri: https://github.com/mingxiao/bosh.git
      branch: develop
#      branch: {{stemcell-branch}}

  - name: version
    type: semver
    source:
      driver: s3
      key: bosh-stemcell/version
      bucket: {{stemcell_bucket}}
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: syslog-release
    type: bosh-io-release
    source:
      repository: cloudfoundry/syslog-release

  #
  # WARDEN
  #

  - name: warden-boshlite-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/warden/bosh-stemcell-(.+)-warden-boshlite-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: warden-boshlite-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/warden/bosh-stemcell-(.+)-warden-boshlite-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # AWS
  #

  - name: aws-xen-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/aws/bosh-stemcell-(.+)-aws-xen-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: aws-xen-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/aws/bosh-stemcell-(.+)-aws-xen-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # Azure
  #

  - name: azure-hyperv-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/azure/bosh-stemcell-(.+)-azure-hyperv-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: azure-hyperv-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/azure/bosh-stemcell-(.+)-azure-hyperv-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # Google
  #

  - name: google-kvm-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-google-kvm-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: google-kvm-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-google-kvm-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # OpenStack
  #

  - name: openstack-kvm-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: openstack-kvm-ubuntu-trusty-raw
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-ubuntu-trusty-go_agent-raw.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: openstack-kvm-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: openstack-kvm-centos-7-raw
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-centos-7-go_agent-raw.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # SoftLayer
  #

  - name: softlayer-xen-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/softlayer/bosh-stemcell-(.+)-softlayer-xen-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: softlayer-xen-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/softlayer/bosh-stemcell-(.+)-softlayer-xen-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  #
  # vSphere
  #

  - name: vsphere-esxi-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/vsphere/bosh-stemcell-(.+)-vsphere-esxi-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}

  - name: vsphere-esxi-centos-7
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/vsphere/bosh-stemcell-(.+)-vsphere-esxi-centos-7-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}
  #
  # vCloud
  #

  - name: vcloud-esxi-ubuntu-trusty
    type: s3
    source:
      bucket: {{stemcell_bucket}}
      regexp: bosh-stemcell-candidate/vcloud/bosh-stemcell-(.+)-vcloud-esxi-ubuntu-trusty-go_agent.tgz
      access_key_id: {{stemcell_aws_access_key}}
      secret_access_key: {{stemcell_aws_secret_key}}
